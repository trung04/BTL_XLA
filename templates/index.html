<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <title>Document</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

</head>
<script type="text/javascript">
  var mousePressed = false;
  var lastX, lastY;
  var ctx;

  function init() {
    canvas = document.getElementById('myCanvas');
    ctx = canvas.getContext('2d');
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    $('#myCanvas').mousedown(function (e) {
      mousePressed = true;
      draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, false);
    });
    $('#myCanvas').mousemove(function (e) {
      if (mousePressed) {
        draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, true);
      }
    });
    $('#myCanvas').mouseup(function (e) {
      mousePressed = false;
    });
    $('#myCanvas').mouseleave(function (e) {
      mousePressed = false;
    });
  }


  function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clears the canvas
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  function draw(x, y, isDown) {
    if (isDown) {
      ctx.beginPath();
      ctx.strokeStyle = $('#selColor').val();
      ctx.lineWidth = $('#selWidth').val();
      ctx.lineJoin = 'round';
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.closePath();
      ctx.stroke();
    }
    lastX = x;
    lastY = y;
  }
  function postImage() {
    var img = document.getElementById("myCanvas").toDataURL("image/png");
    img = img.replace(/^data:image\/(png|jpg);base64,/, "");

    $.ajax({
      type: 'POST',
      url: '/recognize',
      data: JSON.stringify({ data: img }),
      contentType: 'application/json;charset=UTF-8',
      dataType: 'json',
      success: function (response) {
        
        document.getElementById("result").innerHTML = "Recognized character: " + response.prediction;
      }
    });
  }


</script>

<body onload="init()">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Character recognition</h1>

        Line width:
        <select id="selWidth">
          <option value="11">11</option>
          <option value="13">13</option>
          <option value="15">15</option>
          <option value="20" selected="selected">20</option>
          <option value="25">25</option>
        </select>

        Color:
        <select id="selColor">
          <option value="black" selected="selected">black</option>
          <option value="blue">blue</option>
          <option value="red">red</option>
          <option value="green">green</option>
          <option value="gray">gray</option>
        </select>

        <canvas id="myCanvas" width="280" height="280" style="border:2px solid black; margin:5%;"></canvas>
        <br><br>

        <button class="btn btn-danger" onclick=clearCanvas()>Clear</button>
        <button class="btn btn-primary" onclick=postImage()>Recognize</button>

        <br><br>
        <h4>Result:</h4>
        <div id="result"></div>
      </div>
    </div>
  </div>

</body>

</html>